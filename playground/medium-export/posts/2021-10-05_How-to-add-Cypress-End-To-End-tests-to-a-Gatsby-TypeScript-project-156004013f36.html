<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>How to add Cypress End-To-End tests to a Gatsby TypeScript project</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">How to add Cypress End-To-End tests to a Gatsby TypeScript project</h1>
</header>
<section data-field="subtitle" class="p-summary">
End-To-End tests are vital for any front-end project if you‚Äôre concerned about the quality of the experience you provide to users with your‚Ä¶
</section>
<section data-field="body" class="e-content">
<section name="c7f1" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="48e8" id="48e8" class="graf graf--h3 graf--leading graf--title">How to add Cypress End-To-End tests to a Gatsby TypeScript project</h3><figure name="ee10" id="ee10" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*BpLXmjePx14gbaUELsp8yg@2x.png" data-width="4240" data-height="1600" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*BpLXmjePx14gbaUELsp8yg@2x.png"></figure><p name="5ed4" id="5ed4" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--figure"><span class="graf-dropCap">E</span>nd-To-End tests are vital for any front-end project if you‚Äôre concerned about the quality of the experience you provide to users with your application.</p><p name="1867" id="1867" class="graf graf--p graf-after--p">In this post, I will go through the process of adding E2E tests to a Gatsby TypeScript project with <a href="https://www.cypress.io/" data-href="https://www.cypress.io/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Cypress</a>.</p><h3 name="c918" id="c918" class="graf graf--h3 graf-after--p">Pre-requisites</h3><p name="a088" id="a088" class="graf graf--p graf-after--h3">You will need a Gatsby application to try this out. I will be using the <a href="https://github.com/brionmario/gatsby-starter" data-href="https://github.com/brionmario/gatsby-starter" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Gatsby Starter</a> project that I built. Feel free to use the same or you can use this approach on any Gatsby TypeScript project.</p><blockquote name="c266" id="c266" class="graf graf--blockquote graf-after--p">Read the <a href="https://www.gatsbyjs.com/docs/quick-start/" data-href="https://www.gatsbyjs.com/docs/quick-start/" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">docs</a> to learn how to create a Gatsby app or explore other TypeScript <a href="https://www.gatsbyjs.com/starters/?" data-href="https://www.gatsbyjs.com/starters/?" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">starters</a>.</blockquote><h3 name="310a" id="310a" class="graf graf--h3 graf-after--blockquote">Let‚Äôs get¬†started</h3><h4 name="71ac" id="71ac" class="graf graf--h4 graf-after--h3">Install Cypress</h4><pre name="6944" id="6944" class="graf graf--pre graf-after--h4">npm i --save-dev cypress</pre><h4 name="80e9" id="80e9" class="graf graf--h4 graf-after--pre">Add helper npm¬†scripts</h4><p name="27c9" id="27c9" class="graf graf--p graf-after--h4">Add the following two scripts in the <strong class="markup--strong markup--p-strong">script</strong> section in <code class="markup--code markup--p-code">package.json</code>.</p><pre name="ad6c" id="ad6c" class="graf graf--pre graf-after--p">&quot;cy:headless&quot;: &quot;cypress run&quot;,<br>&quot;cy:interactive&quot;: &quot;cypress open&quot;,</pre><p name="51ca" id="51ca" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">cy:headless</strong></p><p name="3020" id="3020" class="graf graf--p graf-after--p">Runs Cypress in <a href="https://docs.cypress.io/guides/guides/command-line#cypress-run-headless" data-href="https://docs.cypress.io/guides/guides/command-line#cypress-run-headless" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">headless mode</a>. Headless mode runs the tests without using any browser and outputs to the terminal.</p><p name="15bd" id="15bd" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">cy:interactive</strong></p><p name="97c2" id="97c2" class="graf graf--p graf-after--p">Runs Cypress in the interactive mode on a <a href="https://docs.cypress.io/guides/core-concepts/test-runner#Overview" data-href="https://docs.cypress.io/guides/core-concepts/test-runner#Overview" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">test runner</a>.</p><h4 name="283e" id="283e" class="graf graf--h4 graf-after--p">Initial Run</h4><p name="786d" id="786d" class="graf graf--p graf-after--h4">Let‚Äôs run cypress in the interactive mode.</p><pre name="2adf" id="2adf" class="graf graf--pre graf-after--p">npm run cy:interactive</pre><p name="694f" id="694f" class="graf graf--p graf-after--pre">Cypress will recognize that this is the first time, and will set up the necessary files and configurations, and will open up the test runner.</p><figure name="0f35" id="0f35" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*To8voGdMTxFiJpAF9PBLiw.png" data-width="1830" data-height="1348" src="https://cdn-images-1.medium.com/max/800/1*To8voGdMTxFiJpAF9PBLiw.png"><figcaption class="imageCaption">Initial Autogenerated Files &amp;¬†Folders</figcaption></figure><figure name="a535" id="a535" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*cK_AJ5bktWtCrR8CjtItuQ.png" data-width="3840" data-height="2400" src="https://cdn-images-1.medium.com/max/800/1*cK_AJ5bktWtCrR8CjtItuQ.png"><figcaption class="imageCaption">Initial Test¬†Runner</figcaption></figure><h4 name="541d" id="541d" class="graf graf--h4 graf-after--figure">Add configurations</h4><p name="5098" id="5098" class="graf graf--p graf-after--h4">Let‚Äôs configure some basics in the <code class="markup--code markup--p-code">cypress.json</code> file.</p><figure name="8121" id="8121" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/a46e2bc2eb03f31306db6f90aabbbc37.js"></script><figcaption class="imageCaption">Basic Cypress Configuration</figcaption></figure><p name="2606" id="2606" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">baseUrl</strong></p><p name="e0f9" id="e0f9" class="graf graf--p graf-after--p">URL used as a prefix for <code class="markup--code markup--p-code u-paddingRight0 u-marginRight0"><a href="https://docs.cypress.io/api/commands/visit" data-href="https://docs.cypress.io/api/commands/visit" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">cy.visit()</a>.</code> Since my starter runs on <a href="http://localhost:8000" data-href="http://localhost:8000" class="markup--anchor markup--p-anchor" target="_blank">localhost port 8000</a>, I will be using that. You can add the URL for your own app here.</p><p name="6ca9" id="6ca9" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">integrationFolder</strong></p><p name="1ff7" id="1ff7" class="graf graf--p graf-after--p">Where tests are held. I prefer to rename this as <strong class="markup--strong markup--p-strong">e2e </strong>when I‚Äôm writing End-To-End tests using Cypress. Since integration could convey the wrong meaning in the context of e2e testing üòâ.</p><p name="0322" id="0322" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">testFiles</strong></p><p name="8d0c" id="8d0c" class="graf graf--p graf-after--p">Glob patterns of the test files to load. I like to name my test files as <code class="markup--code markup--p-code">*.spec.*</code>. You can use any pattern you want.</p><p name="2891" id="2891" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">viewportHeight</strong></p><p name="7281" id="7281" class="graf graf--p graf-after--p">Height in pixels for the application in the test runner. The default is <strong class="markup--strong markup--p-strong">660 </strong>and<strong class="markup--strong markup--p-strong"> </strong>for my starter, it activates the tablet view. Hence, I prefer to go with <strong class="markup--strong markup--p-strong">720</strong>.</p><p name="0673" id="0673" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">viewportWidth</strong></p><p name="6236" id="6236" class="graf graf--p graf-after--p">Width in pixels for the application in the test runner. The default is <strong class="markup--strong markup--p-strong">1000 </strong>and I prefer to go with <strong class="markup--strong markup--p-strong">1080</strong>.</p><h4 name="02db" id="02db" class="graf graf--h4 graf-after--p">Setup e2e¬†folder</h4><p name="c08e" id="c08e" class="graf graf--p graf-after--h4">Remove the <strong class="markup--strong markup--p-strong">cypress/integration</strong> folder inside the cypress directory and create a new folder called <strong class="markup--strong markup--p-strong">e2e </strong>inside<strong class="markup--strong markup--p-strong"> </strong>the<strong class="markup--strong markup--p-strong"> cypress </strong>directory.</p><h4 name="6ef8" id="6ef8" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">Prepare for TypeScript</strong></h4><p name="c182" id="c182" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Configure tsconfig</strong></p><p name="c67d" id="c67d" class="graf graf--p graf-after--p">To write the tests in TypeScript, we need to have a <code class="markup--code markup--p-code">tsconfig.json</code><strong class="markup--strong markup--p-strong"> </strong>file inside the <strong class="markup--strong markup--p-strong">cypress</strong> directory.</p><p name="3e82" id="3e82" class="graf graf--p graf-after--p"><a href="https://docs.cypress.io/guides/tooling/typescript-support#Configure-tsconfig-json" data-href="https://docs.cypress.io/guides/tooling/typescript-support#Configure-tsconfig-json" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Cypress documentation</a> recommends the following configuration.</p><figure name="1940" id="1940" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/bf658a08ac90fff5529664e87eee9e7d.js"></script><figcaption class="imageCaption">Initial tsconfig.json</figcaption></figure><p name="f0e3" id="f0e3" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Migrate existing JavaScript files to TypeScript</strong></p><ol class="postList"><li name="d44d" id="d44d" class="graf graf--li graf-after--p">Rename the <code class="markup--code markup--li-code">index.js</code> file inside <strong class="markup--strong markup--li-strong">cypress/support</strong> directory to <code class="markup--code markup--li-code">index.ts</code></li></ol><p name="eb78" id="eb78" class="graf graf--p graf-after--li">2. Rename the <code class="markup--code markup--p-code">index.js</code> file inside <strong class="markup--strong markup--p-strong">cypress/plugins</strong> directory to <code class="markup--code markup--p-code">index.ts</code></p><p name="dbb0" id="dbb0" class="graf graf--p graf-after--p">The IDE will start to complain that it cannot find the name ‚Äòmodule‚Äô(TS2591). To fix this follow the steps below.</p><ul class="postList"><li name="a64b" id="a64b" class="graf graf--li graf-after--p">Install <a href="https://www.npmjs.com/package/@types/node" data-href="https://www.npmjs.com/package/@types/node" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">@types/node</a>.</li></ul><pre name="7dda" id="7dda" class="graf graf--pre graf-after--li">npm i --save-dev <a href="http://twitter.com/types/node" data-href="http://twitter.com/types/node" class="markup--anchor markup--pre-anchor" title="Twitter profile for @types/node" rel="noopener" target="_blank">@types/node</a></pre><ul class="postList"><li name="16c8" id="16c8" class="graf graf--li graf-after--pre">Add ‚Äúnode‚Äù to <strong class="markup--strong markup--li-strong">types</strong> array in <code class="markup--code markup--li-code">tsconfig.json</code><strong class="markup--strong markup--li-strong">.</strong></li></ul><figure name="2f1b" id="2f1b" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/brionmario/7b9dd898162639b158851cc784548420.js"></script><figcaption class="imageCaption">tsconfig.json with @types/node</figcaption></figure><h4 name="228a" id="228a" class="graf graf--h4 graf-after--figure">Let‚Äôs write our first¬†test</h4><p name="292c" id="292c" class="graf graf--p graf-after--h4">Create a new file called <code class="markup--code markup--p-code">smoke.spec.ts</code></p><p name="559c" id="559c" class="graf graf--p graf-after--p">In this test, I will assert if the app can navigate to the <strong class="markup--strong markup--p-strong">Home</strong> page and <strong class="markup--strong markup--p-strong">Pricing</strong> page successfully.</p><figure name="4b0c" id="4b0c" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/4ef1bb126c15b6d21ee2145403289eab.js"></script><figcaption class="imageCaption">Smoke Tests for the Application</figcaption></figure><figure name="a272" id="a272" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*yusFumRL1YN2-2OcPGQjOQ.png" data-width="3830" data-height="2232" src="https://cdn-images-1.medium.com/max/800/1*yusFumRL1YN2-2OcPGQjOQ.png"><figcaption class="imageCaption">Test Runner after running the smoke.spec.ts</figcaption></figure><h4 name="981e" id="981e" class="graf graf--h4 graf-after--figure">Let‚Äôs write our first custom¬†command</h4><p name="16d1" id="16d1" class="graf graf--p graf-after--h4">In my project, I use <code class="markup--code markup--p-code">data-testid</code> in elements as a unique id for testing. So I‚Äôm going to write a custom command to query elements using a data test id.</p><p name="55a3" id="55a3" class="graf graf--p graf-after--p">I will create a new file called <code class="markup--code markup--p-code">dom.ts</code> inside the <strong class="markup--strong markup--p-strong">cypress/support </strong>directory and will add a command there.</p><figure name="3f11" id="3f11" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/5f321d222cbaed8370bb49994065da23.js"></script><figcaption class="imageCaption">Dom Custom Commands</figcaption></figure><p name="ffd8" id="ffd8" class="graf graf--p graf-after--figure">Now if I try to use the command in my smoke test file, I will get an error like this.</p><figure name="d39f" id="d39f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*yhiPhUnIYJ-8RFnOwTTupg.png" data-width="1346" data-height="764" src="https://cdn-images-1.medium.com/max/800/1*yhiPhUnIYJ-8RFnOwTTupg.png"><figcaption class="imageCaption">Custom Command¬†Error</figcaption></figure><p name="ba29" id="ba29" class="graf graf--p graf-after--figure">This happens because TypeScript can not find any declaration file for the command. As of now, we have to write the typings manually to avoid these errors (Read official docs <a href="https://docs.cypress.io/guides/tooling/typescript-support#Types-for-custom-commands" data-href="https://docs.cypress.io/guides/tooling/typescript-support#Types-for-custom-commands" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>).</p><p name="2fcd" id="2fcd" class="graf graf--p graf-after--p">Inside the <strong class="markup--strong markup--p-strong">cypress </strong>directory<strong class="markup--strong markup--p-strong">, </strong>create a new folder called <strong class="markup--strong markup--p-strong">types</strong>. And inside that, create a new file called <code class="markup--code markup--p-code">index.d.ts</code></p><p name="65a1" id="65a1" class="graf graf--p graf-after--p">Now define the typings for the custom command.</p><figure name="3e66" id="3e66" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/2e7f6dd1b1a0ad1a6b9e00b0e1a0cd57.js"></script><figcaption class="imageCaption">Type declaration for the custom command</figcaption></figure><p name="e13b" id="e13b" class="graf graf--p graf-after--figure">With this fix, the error should be gone and we should be able to invoke the custom command inside the test files.</p><h4 name="56f9" id="56f9" class="graf graf--h4 graf-after--p">Additional Step</h4><p name="c9eb" id="c9eb" class="graf graf--p graf-after--h4">With the existing configurations, we have to fist start the application and then run the test suite.</p><p name="26b7" id="26b7" class="graf graf--p graf-after--p">This is a cumbersome process and it would be better if there is a ways to fire up the server and run the tests with a single command.</p><p name="0e7b" id="0e7b" class="graf graf--p graf-after--p">For this purpose, we can use the <a href="https://www.npmjs.com/package/start-server-and-test" data-href="https://www.npmjs.com/package/start-server-and-test" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">start-server-and-test</a> package.</p><ol class="postList"><li name="e23c" id="e23c" class="graf graf--li graf-after--p">Install</li></ol><pre name="5859" id="5859" class="graf graf--pre graf-after--li">npm install --save-dev start-server-and-test</pre><p name="4c31" id="4c31" class="graf graf--p graf-after--pre">2. Create an npm script.</p><pre name="6917" id="6917" class="graf graf--pre graf-after--p">&quot;test:e2e&quot;: &quot;start-server-and-test start <a href="http://localhost:8000" data-href="http://localhost:8000" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">http://localhost:8000</a> cy:interactive&quot;</pre><p name="615b" id="615b" class="graf graf--p graf-after--pre">Now if you execute <code class="markup--code markup--p-code">npm run test:e2e</code>¬†, the script will execute <code class="markup--code markup--p-code">npm run start</code> and will fire up the application and after it is up, it‚Äôll run Cypress in interactive mode.</p><h3 name="6930" id="6930" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="a47a" id="a47a" class="graf graf--p graf-after--h3">Hope you found this blog post useful. Feel free to try this out and if you have any suggestions regarding the blog you can log an issue in <a href="https://github.com/brionmario/blog-resources/issues" data-href="https://github.com/brionmario/blog-resources/issues" class="markup--anchor markup--p-anchor" rel="noopener nofollow noopener noopener noopener" target="_blank">this repo</a>.</p><h4 name="e25f" id="e25f" class="graf graf--h4 graf-after--p">Links</h4><ul class="postList"><li name="ed10" id="ed10" class="graf graf--li graf-after--h4"><a href="https://github.com/brionmario/gatsby-starter/tree/init-cypress-e2e" data-href="https://github.com/brionmario/gatsby-starter/tree/init-cypress-e2e" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Source Code</a></li></ul><p name="97c7" id="97c7" class="graf graf--p graf-after--li graf--trailing">Signing off‚Ä¶ ‚úåÔ∏è‚ù§Ô∏è</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@brionmario" class="p-author h-card">Brion Mario</a> on <a href="https://medium.com/p/156004013f36"><time class="dt-published" datetime="2021-10-05T09:18:17.280Z">October 5, 2021</time></a>.</p><p><a href="https://medium.com/@brionmario/how-to-add-cypress-end-to-end-tests-to-a-gatsby-typescript-project-156004013f36" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 5, 2023.</p></footer></article></body></html>